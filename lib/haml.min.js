/*
  clientside HAML compiler for Javascript and Coffeescript (Version 4)

  Copyright 2011-12, Ronald Holshausen (https://github.com/uglyog)
  Released under the MIT License (http://www.opensource.org/licenses/MIT)
*/(function(){var a,b,c,d,e,f,g,h,i=Object.prototype.hasOwnProperty,j=function(a,b){function d(){this.constructor=a}for(var c in b)i.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};h=this,d={escapeHTML:function(a){return String(a||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},perserveWhitespace:function(a){var b,c,d,e;d=/<[a-zA-Z]+>[^<]*<\/[a-zA-Z]+>/g,c="",b=0,e=d.exec(a);if(e){while(e)c+=a.substring(b,e.index),c+=e[0].replace(/\n/g,"&#x000A;"),b=e.index+e[0].length,e=d.exec(a);c+=a.substring(b)}else c=a;return c},templateError:function(a,b,c,d){var e,f;f=d+" at line "+a+" and character "+b+":\n"+c+"\n",e=0;while(e<b-1)f+="-",e++;return f+="^",f},generateElementAttributes:function(a,b,c,d,e,f,g,h,j){var k,l,m,n,o,p,q,r,s;l={},l=this.combineAttributes(l,"id",b),c.length>0&&c[0].length>0&&(l=this.combineAttributes(l,"class",c));if(e)for(k in e){if(!i.call(e,k))continue;l=this.combineAttributes(l,k,e[k])}if(d)try{r=d.call(a,a),r&&(s=null,r.id?s=r.id:r.get&&(s=r.get("id")),l=this.combineAttributes(l,"id",s),m=null,r["class"]?m=r["class"]:r.get&&(m=r.get("class")),l=this.combineAttributes(l,"class",m))}catch(t){throw haml.HamlRuntime.templateError(g,h,j,"Error evaluating object reference - "+t)}if(f)try{p=f.call(a,a);if(p)for(k in p){if(!i.call(p,k))continue;if(k==="data"){o=p[k];for(n in o){if(!i.call(o,n))continue;l=this.combineAttributes(l,"data-"+n,o[n])}}else l=this.combineAttributes(l,k,p[k])}}catch(u){throw haml.HamlRuntime.templateError(g,h,j,"Error evaluating attribute hash - "+u)}q="";if(l)for(k in l){if(!i.call(l,k))continue;haml.hasValue(l[k])&&((k==="id"||k==="for")&&l[k]instanceof Array?q+=" "+k+'="'+_(l[k]).flatten().join("-")+'"':k==="class"&&l[k]instanceof Array?q+=" "+k+'="'+_(l[k]).flatten().join(" ")+'"':q+=" "+k+'="'+haml.attrValue(k,l[k])+'"')}return q},indentText:function(a){var b,c;c="",b=0;while(b<a)c+="  ",b++;return c},combineAttributes:function(a,b,c){var d;return haml.hasValue(c)&&(b==="id"&&c.toString().length>0?a&&a.id instanceof Array?a.id.unshift(c):a&&a.id?a.id=[a.id,c]:a?a.id=c:a={id:c}:b==="for"&&c.toString().length>0?a&&a["for"]instanceof Array?a["for"].unshift(c):a&&a["for"]?a["for"]=[a["for"],c]:a?a["for"]=c:a={"for":c}:b==="class"?(d=[],c instanceof Array?d=d.concat(c):d.push(c),a&&a["class"]?a["class"]=a["class"].concat(d):a?a["class"]=d:a={"class":d}):b!=="id"&&(a||(a={}),a[b]=c)),a}},f=function(){function a(a){var b,c,d,e=this;this.buffer=null,this.bufferIndex=null,this.prevToken=null,this.token=null;if(a.templateId!=null){d=document.getElementById(a.templateId);if(!d)throw"Did not find a template with ID '"+a.templateId+"'";this.buffer=d.text,this.bufferIndex=0}else a.template!=null?(this.buffer=a.template,this.bufferIndex=0):a.templateUrl!=null&&(b=function(b,c,d){throw"Failed to fetch haml template at URL "+a.templateUrl+": "+c+" "+d},c=function(a){return e.buffer=a,e.bufferIndex=0},jQuery.ajax({url:a.templateUrl,success:c,error:b,dataType:"text",async:!1,xhrFields:{withCredentials:!0}}))}return a.prototype.currentLineMatcher=/[^\n]*/g,a.prototype.tokenMatchers={whitespace:/[ \t]+/g,element:/%[a-zA-Z][a-zA-Z0-9]*/g,idSelector:/#[a-zA-Z_\-][a-zA-Z0-9_\-]*/g,classSelector:/\.[a-zA-Z0-9_\-]+/g,identifier:/[a-zA-Z][a-zA-Z0-9\-]*/g,quotedString:/[\'][^\'\n]*[\']/g,quotedString2:/[\"][^\"\n]*[\"]/g,comment:/\-#/g,escapeHtml:/\&=/g,unescapeHtml:/\!=/g,objectReference:/\[[a-zA-Z_@][a-zA-Z0-9_]*\]/g,doctype:/!!!/g,continueLine:/\|\s*\n/g,filter:/:\w+/g},a.prototype.matchToken=function(a){var b;a.lastIndex=this.bufferIndex,b=a.exec(this.buffer);if((b!=null?b.index:void 0)===this.bufferIndex)return b[0]},a.prototype.matchMultiCharToken=function(a,b,c){var d,e;if(!this.token){d=this.matchToken(a);if(d)return this.token=b,this.token.tokenString=(e=typeof c==="function"?c(d):void 0)!=null?e:d,this.token.matched=d,this.advanceCharsInBuffer(d.length)}},a.prototype.matchSingleCharToken=function(a,b){if(!this.token&&this.buffer.charAt(this.bufferIndex)===a)return this.token=b,this.token.tokenString=a,this.token.matched=a,this.advanceCharsInBuffer(1)},a.prototype.getNextToken=function(){var a,b,c,d,e,f,g;if(isNaN(this.bufferIndex))throw haml.HamlRuntime.templateError(this.lineNumber,this.characterNumber,this.currentLine,"An internal parser error has occurred in the HAML parser");this.prevToken=this.token,this.token=null;if(this.buffer===null||this.buffer.length===this.bufferIndex)this.token={eof:!0,token:"EOF"};else{this.initLine();if(!this.token){b=this.buffer.charCodeAt(this.bufferIndex),c=this.buffer.charCodeAt(this.bufferIndex+1);if(b===10||b===13&&c===10)this.token={eol:!0,token:"EOL"},b===13&&c===10?(this.advanceCharsInBuffer(2),this.token.matched=String.fromCharCode(b)+String.fromCharCode(c)):(this.advanceCharsInBuffer(1),this.token.matched=String.fromCharCode(b)),this.characterNumber=0,this.currentLine=this.getCurrentLine()}this.matchMultiCharToken(this.tokenMatchers.whitespace,{ws:!0,token:"WS"}),this.matchMultiCharToken(this.tokenMatchers.continueLine,{continueLine:!0,token:"CONTINUELINE"}),this.matchMultiCharToken(this.tokenMatchers.element,{element:!0,token:"ELEMENT"},function(a){return a.substring(1)}),this.matchMultiCharToken(this.tokenMatchers.idSelector,{idSelector:!0,token:"ID"},function(a){return a.substring(1)}),this.matchMultiCharToken(this.tokenMatchers.classSelector,{classSelector:!0,token:"CLASS"},function(a){return a.substring(1)}),this.matchMultiCharToken(this.tokenMatchers.identifier,{identifier:!0,token:"IDENTIFIER"}),this.matchMultiCharToken(this.tokenMatchers.doctype,{doctype:!0,token:"DOCTYPE"}),this.matchMultiCharToken(this.tokenMatchers.filter,{filter:!0,token:"FILTER"},function(a){return a.substring(1)}),this.token||(g=this.matchToken(this.tokenMatchers.quotedString),g||(g=this.matchToken(this.tokenMatchers.quotedString2)),g&&(this.token={string:!0,token:"STRING",tokenString:g.substring(1,g.length-1),matched:g},this.advanceCharsInBuffer(g.length))),this.matchMultiCharToken(this.tokenMatchers.comment,{comment:!0,token:"COMMENT"}),this.matchMultiCharToken(this.tokenMatchers.escapeHtml,{escapeHtml:!0,token:"ESCAPEHTML"}),this.matchMultiCharToken(this.tokenMatchers.unescapeHtml,{unescapeHtml:!0,token:"UNESCAPEHTML"}),this.matchMultiCharToken(this.tokenMatchers.objectReference,{objectReference:!0,token:"OBJECTREFERENCE"},function(a){return a.substring(1,a.length-1)});if(!this.token&&this.buffer&&this.buffer.charAt(this.bufferIndex)==="{"){e=this.bufferIndex+1,d=this.characterNumber,f=this.lineNumber,a=1;while(e<this.buffer.length&&(a>1||this.buffer.charAt(e)!=="}"))this.buffer.charAt(e)==="{"?a++:this.buffer.charAt(e)==="}"&&a--,e++;if(e===this.buffer.length)throw this.characterNumber=d+1,this.lineNumber=f,this.parseError('Error parsing attribute hash - Did not find a terminating "}"');this.token={attributeHash:!0,token:"ATTRHASH",tokenString:this.buffer.substring(this.bufferIndex,e+1),matched:this.buffer.substring(this.bufferIndex,e+1)},this.advanceCharsInBuffer(e-this.bufferIndex+1)}this.matchSingleCharToken("(",{openBracket:!0,token:"OPENBRACKET"}),this.matchSingleCharToken(")",{closeBracket:!0,token:"CLOSEBRACKET"}),this.matchSingleCharToken("=",{equal:!0,token:"EQUAL"}),this.matchSingleCharToken("/",{slash:!0,token:"SLASH"}),this.matchSingleCharToken("!",{exclamation:!0,token:"EXCLAMATION"}),this.matchSingleCharToken("-",{minus:!0,token:"MINUS"}),this.matchSingleCharToken("&",{amp:!0,token:"AMP"}),this.matchSingleCharToken("<",{lt:!0,token:"LT"}),this.matchSingleCharToken(">",{gt:!0,token:"GT"}),this.matchSingleCharToken("~",{tilde:!0,token:"TILDE"}),this.token===null&&(this.token={unknown:!0,token:"UNKNOWN"})}return this.token},a.prototype.lookAhead=function(a){var b,c,d,e,f,g,h,i;i=null;if(a>0){e=this.token,h=this.prevToken,d=this.currentLine,g=this.lineNumber,c=this.characterNumber,b=this.bufferIndex,f=0;while(f++<a)i=this.getNextToken();this.token=e,this.prevToken=h,this.currentLine=d,this.lineNumber=g,this.characterNumber=c,this.bufferIndex=b}return i},a.prototype.initLine=function(){if(!this.currentLine&&this.currentLine!=="")return this.currentLine=this.getCurrentLine(),this.lineNumber=1,this.characterNumber=0},a.prototype.getCurrentLine=function(a){var b;return this.currentLineMatcher.lastIndex=this.bufferIndex+(a!=null?a:0),b=this.currentLineMatcher.exec(this.buffer),b?b[0]:""},a.prototype.parseError=function(a){return haml.HamlRuntime.templateError(this.lineNumber,this.characterNumber,this.currentLine,a)},a.prototype.skipToEOLorEOF=function(){var a,b,c;return c="",!this.token.eof&&!this.token.eol&&(this.token.unknown||(c+=this.token.matched),this.currentLineMatcher.lastIndex=this.bufferIndex,b=this.currentLineMatcher.exec(this.buffer),b&&b.index===this.bufferIndex&&(a=_(b[0]).rtrim(),_(a).endsWith("|")?(c+=a.substring(0,a.length-1),this.advanceCharsInBuffer(a.length-1),this.getNextToken(),c+=this.parseMultiLine()):(c+=b[0],this.advanceCharsInBuffer(b[0].length),this.getNextToken()))),c},a.prototype.parseMultiLine=function(){var a,b,c;c="";while(this.token.continueLine)this.currentLineMatcher.lastIndex=this.bufferIndex,b=this.currentLineMatcher.exec(this.buffer),b&&b.index===this.bufferIndex&&(a=_(b[0]).rtrim(),_(a).endsWith("|")&&(c+=a.substring(0,a.length-1),this.advanceCharsInBuffer(a.length-1)),this.getNextToken());return c},a.prototype.advanceCharsInBuffer=function(a){var b,c,d;d=0;while(d<a)b=this.buffer.charCodeAt(this.bufferIndex+d),c=this.buffer.charCodeAt(this.bufferIndex+d+1),b===13&&c===10?(this.lineNumber++,this.characterNumber=0,this.currentLine=this.getCurrentLine(d),d++):b===10?(this.lineNumber++,this.characterNumber=0,this.currentLine=this.getCurrentLine(d)):this.characterNumber++,d++;return this.bufferIndex+=a},a.prototype.currentParsePoint=function(){return{lineNumber:this.lineNumber,characterNumber:this.characterNumber,currentLine:this.currentLine}},a.prototype.pushBackToken=function(){if(!this.token.unknown&&!this.token.eof)return this.bufferIndex-=this.token.matched.length,this.token=this.prevToken},a.prototype.isEolOrEof=function(){return this.token.eol||this.token.eof},a}(),a=function(){function a(a){this.generator=a,this.buffer="",this.outputBuffer=""}return a.prototype.append=function(a){this.buffer.length===0&&this.generator.mark();if(a&&a.length>0)return this.buffer+=a},a.prototype.appendToOutputBuffer=function(a){if(a&&a.length>0)return this.flush(),this.outputBuffer+=a},a.prototype.flush=function(){return this.buffer&&this.buffer.length>0&&(this.outputBuffer+=this.generator.generateFlush(this.buffer)),this.buffer=""},a.prototype.output=function(){return this.outputBuffer},a.prototype.trimWhitespace=function(){var a,b;if(this.buffer.length>0){b=this.buffer.length-1;while(b>0){a=this.buffer.charAt(b);if(a===" "||a==="	"||a==="\n")b--;else{if(!(b>1)||a!=="n"&&a!=="t"||this.buffer.charAt(b-1)!=="\\")break;b-=2}}if(b>0&&b<this.buffer.length-1)return this.buffer=this.buffer.substring(0,b+1);if(b===0)return this.buffer=""}},a}(),b=function(){function a(){}return a.prototype.embeddedCodeBlockMatcher=/#{([^}]*)}/g,a}(),e=function(a){function b(){this.outputBuffer=new haml.Buffer(this)}return j(b,a),b.prototype.appendEmbeddedCode=function(a,b,c,d,e){return this.outputBuffer.flush(),this.outputBuffer.appendToOutputBuffer(a+"try {\n"),this.outputBuffer.appendToOutputBuffer(a+'    var value = eval("'+b.replace(/"/g,'\\"').replace(/\\n/g,"\\\\n")+'");\n'),this.outputBuffer.appendToOutputBuffer(a+'    value = value === null ? "" : value;'),c?this.outputBuffer.appendToOutputBuffer(a+"    html.push(haml.HamlRuntime.escapeHTML(String(value)));\n"):d?this.outputBuffer.appendToOutputBuffer(a+"    html.push(haml.HamlRuntime.perserveWhitespace(String(value)));\n"):this.outputBuffer.appendToOutputBuffer(a+"    html.push(String(value));\n"),this.outputBuffer.appendToOutputBuffer(a+"} catch (e) {\n"),this.outputBuffer.appendToOutputBuffer(a+"  throw new Error(haml.HamlRuntime.templateError("+e.lineNumber+", "+e.characterNumber+', "'+this.escapeCode(e.currentLine)+'",\n'),this.outputBuffer.appendToOutputBuffer(a+'    "Error evaluating expression - " + e));\n'),this.outputBuffer.appendToOutputBuffer(a+"}\n")},b.prototype.initOutput=function(){return this.outputBuffer.appendToOutputBuffer("  var html = [];\n  var hashFunction = null, hashObject = null, objRef = null, objRefFn = null;\n  with (context || {}) {\n")},b.prototype.closeAndReturnOutput=function(){return this.outputBuffer.flush(),this.outputBuffer.output()+'  }\n  return html.join("");\n'},b.prototype.appendCodeLine=function(a,b){return this.outputBuffer.flush(),this.outputBuffer.appendToOutputBuffer(d.indentText(this.indent)),this.outputBuffer.appendToOutputBuffer(a),this.outputBuffer.appendToOutputBuffer(b)},b.prototype.lineMatchesStartFunctionBlock=function(a){return a.match(/function\s\((,?\s*\w+)*\)\s*\{\s*$/)},b.prototype.lineMatchesStartBlock=function(a){return a.match(/\{\s*$/)},b.prototype.closeOffCodeBlock=function(a){if(!a.token.minus||!a.matchToken(/\s*\}/g))return this.outputBuffer.flush(),this.outputBuffer.appendToOutputBuffer(d.indentText(this.indent)+"}\n")},b.prototype.closeOffFunctionBlock=function(a){if(!a.token.minus||!a.matchToken(/\s*\}/g))return this.outputBuffer.flush(),this.outputBuffer.appendToOutputBuffer(d.indentText(this.indent)+"});\n")},b.prototype.generateCodeForDynamicAttributes=function(a,b,c,d,e,f){return this.outputBuffer.flush(),d.length>0&&(d=this.replaceReservedWordsInHash(d),this.outputBuffer.appendToOutputBuffer('    hashFunction = function () { return eval("hashObject = '+d.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"); };\n')),e.length>0&&this.outputBuffer.appendToOutputBuffer('    objRefFn = function () { return eval("objRef = '+e.replace(/"/g,'\\"')+'"); };\n'),this.outputBuffer.appendToOutputBuffer('    html.push(haml.HamlRuntime.generateElementAttributes(context, "'+a+'", ["'+b.join('","')+'"], objRefFn, '+JSON.stringify(c)+", hashFunction, "+f.lineNumber+", "+f.characterNumber+', "'+this.escapeCode(f.currentLine)+'"));\n')},b.prototype.replaceReservedWordsInHash=function(a){var b,c,d,e,f;c=a,f=["class","for"];for(d=0,e=f.length;d<e;d++)b=f[d],c=c.replace(b+":",'"'+b+'":');return c},b.prototype.escapeCode=function(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")},b.prototype.generateJsFunction=function(a){try{return new Function("context",a)}catch(b){throw"Incorrect embedded code has resulted in an invalid Haml function - "+b+"\nGenerated Function:\n"+a}},b.prototype.generateFlush=function(a){return'    html.push("'+this.escapeCode(a)+'");\n'},b.prototype.setIndent=function(a){return this.indent=a},b.prototype.mark=function(){},b.prototype.appendTextContents=function(a,b,c,d){return d==null&&(d={}),b&&a.match(/#{[^}]*}/)?this.interpolateString(a,c,d):this.outputBuffer.append(this.processText(a,d))},b.prototype.interpolateString=function(a,b,c){var e,f,g,h;e=0,h=this.embeddedCodeBlockMatcher.exec(a);while(h)h.index>0&&(f=a.charAt(h.index-1)),h.index>1&&(g=a.charAt(h.index-2)),f==="\\"&&g!=="\\"?(h.index!==0&&this.outputBuffer.append(this.processText(a.substring(e,h.index-1),c)),this.outputBuffer.append(this.processText(h[0]),c)):(this.outputBuffer.append(this.processText(a.substring(e,h.index)),c),this.appendEmbeddedCode(d.indentText(this.indent+1),h[1],c.escapeHTML,c.perserveWhitespace,b)),e=this.embeddedCodeBlockMatcher.lastIndex,h=this.embeddedCodeBlockMatcher.exec(a);if(e<a.length)return this.outputBuffer.append(this.processText(a.substring(e),c))},b.prototype.processText=function(a,b){return(b!=null?b.escapeHTML:void 0)?haml.HamlRuntime.escapeHTML(a):(b!=null?b.perserveWhitespace:void 0)?haml.HamlRuntime.perserveWhitespace(a):a},b}(b),c=function(a){function b(){this.outputBuffer=new haml.Buffer(this)}return j(b,a),b.prototype.appendEmbeddedCode=function(a,b,c,d,e){var f;return this.outputBuffer.flush(),f=this.calcCodeIndent(),this.outputBuffer.appendToOutputBuffer(f+"try\n"),this.outputBuffer.appendToOutputBuffer(f+"  exp = CoffeeScript.compile('"+b.replace(/'/g,"\\'").replace(/\\n/g,"\\\\n")+"', bare: true)\n"),this.outputBuffer.appendToOutputBuffer(f+"  value = eval(exp)\n"),this.outputBuffer.appendToOutputBuffer(f+"  value ?= ''\n"),c?this.outputBuffer.appendToOutputBuffer(f+"  html.push(haml.HamlRuntime.escapeHTML(String(value)))\n"):d?this.outputBuffer.appendToOutputBuffer(f+"  html.push(haml.HamlRuntime.perserveWhitespace(String(value)))\n"):this.outputBuffer.appendToOutputBuffer(f+"  html.push(String(value))\n"),this.outputBuffer.appendToOutputBuffer(f+"catch e \n"),this.outputBuffer.appendToOutputBuffer(f+"  throw new Error(haml.HamlRuntime.templateError("+e.lineNumber+", "+e.characterNumber+", '"+this.escapeCode(e.currentLine)+"',\n"),this.outputBuffer.appendToOutputBuffer(f+"    'Error evaluating expression - ' + e))\n")},b.prototype.initOutput=function(){return this.outputBuffer.appendToOutputBuffer("html = []\n")},b.prototype.closeAndReturnOutput=function(){return this.outputBuffer.flush(),this.outputBuffer.output()+'return html.join("")\n'},b.prototype.appendCodeLine=function(a,b){return this.outputBuffer.flush(),this.prevCodeIndent!=null&&this.prevCodeIndent<this.indent&&this.outputBuffer.appendToOutputBuffer(d.indentText(this.indent-this.prevCodeIndent)),this.outputBuffer.appendToOutputBuffer(_(a).trim()),this.outputBuffer.appendToOutputBuffer(b),this.prevCodeIndent=this.indent},b.prototype.lineMatchesStartFunctionBlock=function(a){return a.match(/\) [\-=]>\s*$/)},b.prototype.lineMatchesStartBlock=function(a){return!0},b.prototype.closeOffCodeBlock=function(a){return this.outputBuffer.flush()},b.prototype.closeOffFunctionBlock=function(a){return this.outputBuffer.flush()},b.prototype.generateCodeForDynamicAttributes=function(a,b,c,d,e,f){return this.outputBuffer.flush(),d.length>0&&(d=this.replaceReservedWordsInHash(d),this.outputBuffer.appendToOutputBuffer("hashFunction = () -> s = CoffeeScript.compile('"+d.replace(/'/g,"\\'").replace(/\n/g,"\\n")+"', bare: true); eval 'hashObject = ' + s\n")),e.length>0&&this.outputBuffer.appendToOutputBuffer("objRefFn = () -> s = CoffeeScript.compile('"+e.replace(/'/g,"\\'")+"', bare: true); eval 'objRef = ' + s\n"),this.outputBuffer.appendToOutputBuffer("html.push(haml.HamlRuntime.generateElementAttributes(this, '"+a+"', ['"+b.join("','")+"'], objRefFn ? null, "+JSON.stringify(c)+", hashFunction ? null, "+f.lineNumber+", "+f.characterNumber+", '"+this.escapeCode(f.currentLine)+"'))\n")},b.prototype.replaceReservedWordsInHash=function(a){var b,c,d,e,f;c=a,f=["class","for"];for(d=0,e=f.length;d<e;d++)b=f[d],c=c.replace(b+":","'"+b+"':");return c},b.prototype.escapeCode=function(a){var b,c,d,e,f;c="",b=0,f=this.embeddedCodeBlockMatcher.exec(a);while(f)f.index>0&&(d=a.charAt(f.index-1)),f.index>1&&(e=a.charAt(f.index-2)),d==="\\"&&e!=="\\"?(f.index!==0&&(c+=this._escapeText(a.substring(b,f.index-1))),c+=this._escapeText("\\"+f[0])):(c+=this._escapeText(a.substring(b,f.index)),c+=f[0]),b=this.embeddedCodeBlockMatcher.lastIndex,f=this.embeddedCodeBlockMatcher.exec(a);return b<a.length&&(c+=this._escapeText(a.substring(b))),c},b.prototype._escapeText=function(a){return a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/(^|[^\\]{2})\\\\#{/g,"$1\\#{")},b.prototype.generateJsFunction=function(a){var b;try{return b=CoffeeScript.compile(a,{bare:!0}),new Function(b)}catch(c){throw"Incorrect embedded code has resulted in an invalid Haml function - "+c+"\nGenerated Function:\n"+b}},b.prototype.generateFlush=function(a){return this.calcCodeIndent()+"html.push('"+this.escapeCode(a)+"')\n"},b.prototype.setIndent=function(a){return this.indent=a},b.prototype.mark=function(){return this.prevIndent=this.indent},b.prototype.calcCodeIndent=function(){return this.prevCodeIndent!=null&&this.prevIndent>this.prevCodeIndent?d.indentText(this.prevIndent-this.prevCodeIndent):""},b.prototype.appendTextContents=function(a,b,c,d){var e,f;if(b&&a.match(/#{[^}]*}/)){this.outputBuffer.flush(),e=f="";if(d!=null?d.escapeHTML:void 0)e="haml.HamlRuntime.escapeHTML(",f=")";else if(d!=null?d.perserveWhitespace:void 0)e="haml.HamlRuntime.perserveWhitespace(",f=")";return this.outputBuffer.appendToOutputBuffer(this.calcCodeIndent()+"html.push("+e+'"'+this.escapeCode(a)+'"'+f+")\n")}if(d!=null?d.escapeHTML:void 0)a=haml.HamlRuntime.escapeHTML(a);if(d!=null?d.perserveWhitespace:void 0)a=haml.HamlRuntime.perserveWhitespace(a);return this.outputBuffer.append(a)},b}(b),g={plain:function(a,b,c,d){var e,f,g;for(f=0,g=a.length;f<g;f++)e=a[f],b.appendTextContents(c+e+"\n",!0,d);return!0},javascript:function(a,b,c,d){var e,f,g;b.outputBuffer.append(c+'<script type="text/javascript">\n'),b.outputBuffer.append(c+"//<![CDATA[\n");for(f=0,g=a.length;f<g;f++)e=a[f],b.appendTextContents(c+e+"\n",!0,d);return b.outputBuffer.append(c+"//]]>\n"),b.outputBuffer.append(c+"</script>\n")},css:function(a,b,c,d){var e,f,g;b.outputBuffer.append(c+'<style type="text/css">\n'),b.outputBuffer.append(c+"/*<![CDATA[*/\n");for(f=0,g=a.length;f<g;f++)e=a[f],b.appendTextContents(c+e+"\n",!0,d);return b.outputBuffer.append(c+"/*]]>*/\n"),b.outputBuffer.append(c+"</style>\n")},cdata:function(a,b,c,d){var e,f,g;b.outputBuffer.append(c+"<![CDATA[\n");for(f=0,g=a.length;f<g;f++)e=a[f],b.appendTextContents(c+e+"\n",!0,d);return b.outputBuffer.append(c+"]]>\n")},preserve:function(a,b,c,d){return b.appendTextContents(a.join("\n")+"\n",!0,d,{perserveWhitespace:!0})},escape:function(a,b,c,d){var e,f,g;for(f=0,g=a.length;f<g;f++)e=a[f],b.appendTextContents(c+e+"\n",!0,d,{escapeHTML:!0});return!0}},h.haml={compileHaml:function(a){var b,c,d;if(typeof a=="string")return this._compileHamlTemplate(a,new haml.JsCodeGenerator);a.generator!=="coffeescript"?b=new haml.JsCodeGenerator:b=new haml.CoffeeCodeGenerator;if(a.source!=null)d=new haml.Tokeniser({template:a.source});else if(a.sourceId!=null)d=new haml.Tokeniser({templateId:a.sourceId});else{if(a.sourceUrl==null)throw"No template source specified for compileHaml. You need to provide a source, sourceId or sourceUrl option";d=new haml.Tokeniser({templateUrl:a.sourceUrl})}return c=this._compileHamlToJs(d,b),a.outputFormat!=="string"?b.generateJsFunction(c):"function (context) {\n"+c+"}\n"},compileCoffeeHaml:function(a){return this._compileHamlTemplate(a,new haml.CoffeeCodeGenerator)},compileStringToJs:function(a){var b,c;return b=new haml.JsCodeGenerator,c=this._compileHamlToJs(new haml.Tokeniser({template:a}),b),b.generateJsFunction(c)},compileCoffeeHamlFromString:function(a){var b,c;return b=new haml.CoffeeCodeGenerator,c=this._compileHamlToJs(new haml.Tokeniser({template:a}),b),b.generateJsFunction(c)},compileHamlToJsString:function(a){var b;return b="function (context) {\n",b+=this._compileHamlToJs(new haml.Tokeniser({template:a}),new haml.JsCodeGenerator),b+="}\n"},_compileHamlTemplate:function(a,b){var c,d;return haml.cache||(haml.cache={}),haml.cache[a]?haml.cache[a]:(d=this._compileHamlToJs(new haml.Tokeniser({templateId:a}),b),c=b.generateJsFunction(d),haml.cache[a]=c,c)},_compileHamlToJs:function(a,b){var c,e;c=[],b.initOutput(),a.getNextToken();while(!a.token.eof)a.token.eol?(b.outputBuffer.append(a.token.matched),a.getNextToken()):(e=this._whitespace(a),b.setIndent(e),a.token.eol?(b.outputBuffer.append(d.indentText(e)+a.token.matched),a.getNextToken()):a.token.doctype?this._doctype(a,e,b):a.token.exclamation?this._ignoredLine(a,e,c,b):a.token.equal||a.token.escapeHtml||a.token.unescapeHtml||a.token.tilde?this._embeddedJs(a,e,c,{innerWhitespace:!0},b):a.token.minus?this._jsLine(a,e,c,b):a.token.comment||a.token.slash?this._commentLine(a,e,c,b):a.token.amp?this._escapedLine(a,e,c,b):a.token.filter?this._filter(a,e,b):this._templateLine(a,c,e,b));return this._closeElements(0,c,a,b),b.closeAndReturnOutput()},_doctype:function(a,b,c){var e,f;if(a.token.doctype){c.outputBuffer.append(d.indentText(b)),a.getNextToken(),a.token.ws&&a.getNextToken(),e=a.skipToEOLorEOF();if(e&&e.length>0){f=e.split(/\s+/);switch(f[0]){case"XML":f.length>1?c.outputBuffer.append("<?xml version='1.0' encoding='"+f[1]+"' ?>"):c.outputBuffer.append("<?xml version='1.0' encoding='utf-8' ?>");break;case"Strict":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">');break;case"Frameset":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">');break;case"5":c.outputBuffer.append("<!DOCTYPE html>");break;case"1.1":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">');break;case"Basic":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">');break;case"Mobile":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">');break;case"RDFa":c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN" "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">')}}else c.outputBuffer.append('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">');return c.outputBuffer.append(this._newline(a)),a.getNextToken()}},_filter:function(a,b,c){var d,e,f,g;if(a.token.filter){d=a.token.tokenString;if(!haml.filters[d])throw a.parseError("Filter '"+d+"' not registered. Filter functions need to be added to 'haml.filters'.");a.skipToEOLorEOF(),a.getNextToken(),f=haml._whitespace(a),e=[];while(!a.token.eof&&f>b)g=a.skipToEOLorEOF(),e.push(haml.HamlRuntime.indentText(f-b-1)+g),a.getNextToken(),f=haml._whitespace(a);return haml.filters[d](e,c,haml.HamlRuntime.indentText(b),a.currentParsePoint()),a.pushBackToken()}},_commentLine:function(a,b,c,e){var f,g;if(a.token.comment){a.skipToEOLorEOF(),a.getNextToken(),g=this._whitespace(a);while(!a.token.eof&&g>b)a.skipToEOLorEOF(),a.getNextToken(),g=this._whitespace(a);if(g>0)return a.pushBackToken()}else if(a.token.slash)return haml._closeElements(b,c,a,e),e.outputBuffer.append(d.indentText(b)),e.outputBuffer.append("<!--"),a.getNextToken(),f=a.skipToEOLorEOF(),f&&f.length>0&&e.outputBuffer.append(f),f&&_(f).startsWith("[")&&f.match(/\]\s*$/)?(c[b]={htmlConditionalComment:!0,eol:this._newline(a)},e.outputBuffer.append(">")):c[b]={htmlComment:!0,eol:this._newline(a)},haml._tagHasContents(b,a)&&e.outputBuffer.append("\n"),a.getNextToken()},_escapedLine:function(a,b,c,e){var f;if(a.token.amp)return haml._closeElements(b,c,a,e),e.outputBuffer.append(d.indentText(b)),a.getNextToken(),f=a.skipToEOLorEOF(),f&&f.length>0&&e.outputBuffer.append(haml.HamlRuntime.escapeHTML(f)),e.outputBuffer.append(this._newline(a)),a.getNextToken()},_ignoredLine:function(a,b,c,e){var f;if(a.token.exclamation)return a.getNextToken(),a.token.ws&&(b+=haml._whitespace(a)),haml._closeElements(b,c,a,e),f=a.skipToEOLorEOF(),e.outputBuffer.append(d.indentText(b)+f)},_embeddedJs:function(a,b,c,e,f){var g,h,i,j,k;c&&haml._closeElements(b,c,a,f);if(a.token.equal||a.token.escapeHtml||a.token.unescapeHtml||a.token.tilde){h=a.token.escapeHtml||a.token.equal,k=a.token.tilde,g=a.currentParsePoint(),a.getNextToken(),i=a.skipToEOLorEOF(),j=d.indentText(b),(!e||e.innerWhitespace)&&f.outputBuffer.append(j),f.appendEmbeddedCode(j,i,h,k,g);if(!e||e.innerWhitespace){f.outputBuffer.append(this._newline(a));if(a.token.eol)return a.getNextToken()}}},_jsLine:function(a,b,c,d){var e;if(a.token.minus){haml._closeElements(b,c,a,d),a.getNextToken(),e=a.skipToEOLorEOF(),d.setIndent(b),d.appendCodeLine(e,this._newline(a)),a.token.eol&&a.getNextToken();if(d.lineMatchesStartFunctionBlock(e))return c[b]={fnBlock:!0};if(d.lineMatchesStartBlock(e))return c[b]={block:!0}}},_templateLine:function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r;a.token.eol||this._closeElements(c,b,a,e),m=this._element(a),l=this._idSelector(a),h=this._classSelector(a),p=this._objectReference(a),f=this._attributeList(a),j=a.currentParsePoint(),g=this._attributeHash(a),r={selfClosingTag:!1,innerWhitespace:!0,outerWhitespace:!0},o=this._lineHasElement(m,l,h),a.token.slash&&(r.selfClosingTag=!0,a.getNextToken()),a.token.gt&&o&&(r.outerWhitespace=!1,a.getNextToken()),a.token.lt&&o&&(r.innerWhitespace=!1,a.getNextToken()),o&&(r.selfClosingTag||(r.selfClosingTag=haml._isSelfClosingTag(m)&&!haml._tagHasContents(c,a)),this._openElement(j,c,m,l,h,p,f,g,b,r,e)),k=!1,a.token.ws&&a.getNextToken(),a.token.equal||a.token.escapeHtml||a.token.unescapeHtml?(this._embeddedJs(a,c+1,null,r,e),k=!0):(i="",q=!1,a.token.exclamation?(a.getNextToken(),i=a.skipToEOLorEOF()):(i=a.skipToEOLorEOF(),i.match(/^\\%/)&&(i=i.substring(1)),q=!0),k=i.length>0,k&&(r.innerWhitespace&&o||!o&&haml._parentInnerWhitespace(b,c)?n=d.indentText(m.length>0?c+1:c):(n="",i=_(i).trim()),e.appendTextContents(n+i,q,j),e.outputBuffer.append(this._newline(a))),this._eolOrEof(a));if(r.selfClosingTag&&k)throw haml.HamlRuntime.templateError(j.lineNumber,j.characterNumber,j.currentLine,"A self-closing tag can not have any contents")},_attributeHash:function(a){var b;return b="",a.token.attributeHash&&(b=a.token.tokenString,a.getNextToken()),b},_objectReference:function(a){var b;return b="",a.token.objectReference&&(b=a.token.tokenString,a.getNextToken()),b},_attributeList:function(a){var b,c;c={};if(a.token.openBracket){a.getNextToken();while(!a.token.closeBracket){b=haml._attribute(a),b?c[b.name]=b.value:a.getNextToken();if(a.token.ws||a.token.eol)a.getNextToken();else if(!a.token.closeBracket&&!a.token.identifier)throw a.parseError("Expecting either an attribute name to continue the attibutes or a closing bracket to end")}a.getNextToken()}return c},_attribute:function(a){var b,c;b=null;if(a.token.identifier){c=a.token.tokenString,a.getNextToken(),haml._whitespace(a);if(!a.token.equal)throw a.parseError("Expected '=' after attribute name");a.getNextToken(),haml._whitespace(a);if(!a.token.string&&!a.token.identifier)throw a.parseError("Expected a quoted string or an identifier for the attribute value");b={name:c,value:a.token.tokenString},a.getNextToken()}return b},_closeElement:function(a,b,c,e){var f,g;if(b[a])return e.setIndent(a),b[a].htmlComment?e.outputBuffer.append(d.indentText(a)+"-->"+b[a].eol):b[a].htmlConditionalComment?e.outputBuffer.append(d.indentText(a)+"<![endif]-->"+b[a].eol):b[a].block?e.closeOffCodeBlock(c):b[a].fnBlock?e.closeOffFunctionBlock(c):(f=!b[a].tagOptions||b[a].tagOptions.innerWhitespace,f?e.outputBuffer.append(d.indentText(a)):e.outputBuffer.trimWhitespace(),e.outputBuffer.append("</"+b[a].tag+">"),g=!b[a].tagOptions||b[a].tagOptions.outerWhitespace,haml._parentInnerWhitespace(b,a)&&g&&e.outputBuffer.append("\n")),b[a]=null,e.mark()},_closeElements:function(a,b,c,d){var e,f;e=b.length-1,f=[];while(e>=a)f.push(this._closeElement(e--,b,c,d));return f},_openElement:function(a,b,c,e,f,g,h,i,j,k,l){var m,n,o;m=c.length===0?"div":c,n=this._parentInnerWhitespace(j,b),o=!k||k.outerWhitespace,o||l.outputBuffer.trimWhitespace(),b>0&&n&&o&&l.outputBuffer.append(d.indentText(b)),l.outputBuffer.append("<"+m),i.length>0||g.length>0?l.generateCodeForDynamicAttributes(e,f,h,i,g,a):l.outputBuffer.append(d.generateElementAttributes(null,e,f,null,h,null,a.lineNumber,a.characterNumber,a.currentLine));if(k.selfClosingTag){l.outputBuffer.append("/>");if(k.outerWhitespace)return l.outputBuffer.append("\n")}else{l.outputBuffer.append(">"),j[b]={tag:m,tagOptions:k};if(k.innerWhitespace)return l.outputBuffer.append("\n")}},_isSelfClosingTag:function(a){return a==="meta"||a==="img"||a==="link"||a==="script"||a==="br"||a==="hr"},_tagHasContents:function(a,b){var c;return b.isEolOrEof()?(c=b.lookAhead(1),c.ws&&c.tokenString.length/2>a):!0},_parentInnerWhitespace:function(a,b){return b===0||!a[b-1]||!a[b-1].tagOptions||a[b-1].tagOptions.innerWhitespace},_lineHasElement:function(a,b,c){return a.length>0||b.length>0||c.length>0},hasValue:function(a){return a!=null&&a!==!1},attrValue:function(a,b){return a==="selected"||a==="checked"||a==="disabled"?a:b},_whitespace:function(a){var b;return b=0,a.token.ws&&(b=a.token.tokenString.length/2,a.getNextToken()),b},_element:function(a){var b;return b="",a.token.element&&(b=a.token.tokenString,a.getNextToken()),b},_eolOrEof:function(a){if(a.token.eol||a.token.continueLine)return a.getNextToken();if(!a.token.eof)throw a.parseError("Expected EOL or EOF")},_idSelector:function(a){var b;
return b="",a.token.idSelector&&(b=a.token.tokenString,a.getNextToken()),b},_classSelector:function(a){var b;b=[];while(a.token.classSelector)b.push(a.token.tokenString),a.getNextToken();return b},_newline:function(a){return a.token.eol?a.token.matched:a.token.continueLine?a.token.matched.substring(1):"\n"}},h.haml.Tokeniser=f,h.haml.Buffer=a,h.haml.JsCodeGenerator=e,h.haml.CoffeeCodeGenerator=c,h.haml.HamlRuntime=d,h.haml.filters=g}).call(this);